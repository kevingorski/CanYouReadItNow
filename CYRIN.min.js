(function(f){var d={BACKGROUND_COLOR:"Background Color",BACKGROUND_IMAGE:"Background Image",BLOCK_ELEMENT:"Block Element",CHARACTERS_PER_LINE:"Characters Per Line",EFFECTIVE_MARGIN_AND_PADDING:"Effective Margin &amp; Padding",FONT_FAMILIES:"Font Families",FONT_SIZE:"Font Size",JUSTIFICATION:"Justification",KERNING:"Kerning",LINE_LEADING:"Line Leading",LINE_LENGTH:"Line Length",MARGIN:"Margin",MARGIN_AND_PADDING:"Margin &amp; Padding",PADDING:"Padding",PERCENTAGE_OF_TEXT_STYLIZED:"Percentage of Text Stylized",STYLIZED_TEXT:"Stylized Text",TEXT_COLOR:"Text Color",TEXT_COLOR_CONTRAST:"Text Color Contrast",TEXT_LENGTH:"Text Length"},c={};
c[d.FONT_SIZE]="A good default font size will keep the user from having to adjust it manually, which may cause problems with your design.";c[d.JUSTIFICATION]="If you're not left-justifying your text, you're probably doing it wrong.";c[d.LINE_LENGTH]="When line length of text gets too long, it makes text harder to read. [WCAG SC 1.4.8]";c[d.TEXT_COLOR_CONTRAST]="The contrast ratio between the text color and the background color needs to be greater the smaller the text is [WCAG 1.4.6]";c[d.LINE_LEADING]="The space between each line of text should be large enough to make visual separation of lines easy without creating an awkward amount of space [WCAG SC 1.4.8]";
c[d.MARGIN_AND_PADDING]="Creating visual space on the left and right of text will make it easier to visually separate from the rest of the page";c[d.PERCENTAGE_OF_TEXT_STYLIZED]="Bold, italicized, and all caps text should be kept to a minimum";function b(g){return Math.round(g*10)/10}function e(h,i,g){this.DOMNode=h;this.textTreeChildren=i;this.textChildren=g;this.metrics=[]}e.prototype.addMetric=function(g,h){this.metrics.push({name:g,value:h});return this};e.prototype.getMetric=function(h){var g=f.grep(this.metrics,function(i){return i.name===h
});return g&&g.length?g[0].value:false};e.prototype.updateMetric=function(h,i){var g=f.grep(this.metrics,function(j){return j.name===h})[0];g.value=i};function a(g){this.textTree=g;this.score=0;this.aggregateScore=0;this.totalPossible=0;this.totalCharacterCount=0;this.metrics=g?g.metrics:[];this.scores=[];this.aggregateScores=[];this.suggestions=[];this.children=[];if(!g){this.addScore(d.FONT_SIZE,0).addScore(d.JUSTIFICATION,0).addScore(d.TEXT_COLOR_CONTRAST,0).addScore(d.LINE_LEADING,0).addScore(d.LINE_LENGTH,0).addScore(d.PERCENTAGE_OF_TEXT_STYLIZED,0).addScore(d.MARGIN_AND_PADDING,0)
}}a.prototype.addMetric=function(g,h){this.metrics.push({name:g,value:h});return this};a.prototype.addScore=function(g,h){this.scores.push({name:g,value:h,description:c[g]});this.score+=h;this.totalPossible+=10;return this};a.prototype.getAggregateScore=function(g){return f.grep(this.aggregateScores,function(h){return h.name===g})[0].value};a.prototype.hasAggregateScore=function(g){return !!(f.grep(this.aggregateScores,function(h){return h.name===g}).length)};a.prototype.addToAggregate=function(g,h){f.grep(this.aggregateScores,function(i){return i.name===g
})[0].value+=h};a.prototype.addSuggestion=function(g,h){this.suggestions.push({message:g,priority:10-h})};a.prototype.addChild=function(g){this.children.push(g)};a.prototype.sort=function(){var g=function(i,h){return i.name>h.name};this.scores.sort(g);this.aggregateScores.sort(g);this.metrics.sort(g)};a.prototype.applyToAll=function(h){h(this);if(!this.children.length){return}for(var g=this.children.length-1;g>=0;g--){this.children[g].applyToAll(h)}};a.prototype.getMetric=function(h){var g=jQuery.grep(this.metrics,function(i){return i.name===h
})[0];return g.value};a.prototype.getScore=function(g){var h=jQuery.grep(this.scores,function(i){return i.name===g})[0];return h.value};a.prototype.getAggregateScore=function(g){var h=jQuery.grep(this.aggregateScores,function(i){return i.name===g})[0];return h.value};a.prototype.rollUp=function(){var g=this;if(this.children&&this.children.length){var i=this,h=this.textTree?this.textTree.getMetric(d.TEXT_LENGTH):0;i.totalCharacterCount=h;f.each(this.children,function(){i.totalCharacterCount+=this.rollUp()
});if(i.totalCharacterCount>0){i.aggregateScores=f.map(i.scores,function(j){return{name:j.name,value:j.value*h/i.totalCharacterCount,description:j.description}})}f.each(this.children,function(){var k=this,j=k.totalCharacterCount/i.totalCharacterCount;f.each(i.aggregateScores,function(){var l=k.hasAggregateScore(this.name)?k:i;i.addToAggregate(this.name,(l.getAggregateScore(this.name)||0)*j)})});f.each(this.aggregateScores,function(){i.aggregateScore+=this.value;this.value=b(this.value)});i.aggregateScore=b(i.aggregateScore)
}else{this.totalCharacterCount=this.textTree.getMetric(d.TEXT_LENGTH);this.aggregateScores=this.scores;this.aggregateScore=this.score}this.sort();return this.totalCharacterCount};f.CYRIN=function(i,g){var j=this,h;j.el=i;f.CYRIN.defaultOptions.context=document.body;j.init=function(){j.options=f.extend({},f.CYRIN.defaultOptions,g)};j.findDPI=function(){if(h){return h}var k=f("<div />",{css:{position:"absolute",width:"1in"}}).appendTo(document.body);h=k.width();k.remove();return h};j.init()};f.CYRIN.defaultOptions={};
f.extend(f.CYRIN,d);f.CYRIN.version="0.1.0";f.fn.CYRIN=function(m,i){var k=(new f.CYRIN(this,i));function g(E){return parseFloat(/(\d*\.*\d*)/.exec(E)[0])}function o(H){var G=k.findDPI(),F=g(H),E=G/72;return F/E}function n(E){return(E.css("font-weight")+"").match(/^bold.*|[7-9]00/)||E[0].nodeName.match(/strong/i)}function s(H){var F=H.width(),G;if((G=H.css("column-count")||H.css("-webkit-column-count")||H.css("-moz-column-count"))!=="auto"&&G>1){var E=g(H.css("column-gap")||H.css("-webkit-column-gap")||H.css("-moz-column-gap"));
return(F-((G-1)*E))/G}return F}function A(F){if(!F){return false}function E(H){H=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?\)/i.exec(H);if(!H||(H.length===5&&Number(H[4])===0)){return false}var J=Number(H[1]).toString(16),I=Number(H[2]).toString(16),K=Number(H[3]).toString(16);if(J.length<2){J="0"+J}if(I.length<2){I="0"+I}if(K.length<2){K="0"+K}return"#"+J+I+K}function G(I){var H={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};
if(typeof H[I.toLowerCase()]!="undefined"){return H[I.toLowerCase()]}return false}return(F.charAt(0)=="#")?F:F.match(/rgb/i)?E(F):G(F)}function x(F,K){if(!(F&&K)){return false}function H(L){var O=Math.pow(parseInt(L.substr(1,2),16)/255,2.2),N=Math.pow(parseInt(L.substr(3,2),16)/255,2.2),M=Math.pow(parseInt(L.substr(5,2),16)/255,2.2);return 0.2126*O+0.7152*N+0.0722*M}var I=H(F),J=H(K),G,E;G=(I>J)?I:J;E=(I>J)?J:I;return(G+0.05)/(E+0.05)}function u(H){var G=H[0],I=G.childNodes,E=[],F=[];if(G.nodeType===3){return new e(G)
}f.each(I,function(){if(this.nodeType===8||this.nodeName.match(/IMG|BR|SCRIPT|STYLE/)){return}if(this.nodeType===3){if(this.nodeValue.match(/^\s+$/)){return}F.push(this);return}E.push(u(f(this)))});return new e(G,E,F)}function j(H,G,F){var K=f(H.DOMNode),P=A(K.css("background-color"))||G;if(H.textChildren){var S=0,L=K.clone(),J=!!(K.css("display").match(/block/i)),R,O=K.css("line-height"),E,I,N,M,Q;f.each(H.textChildren,function(){S+=this.nodeValue.length});H.addMetric(d.BACKGROUND_COLOR,P).addMetric(d.BACKGROUND_IMAGE,K.css("background-image")).addMetric(d.BLOCK_ELEMENT,J).addMetric(d.FONT_FAMILIES,K.css("font-family")).addMetric(d.FONT_SIZE,R=K.css("font-size")).addMetric(d.JUSTIFICATION,K.css("text-align")).addMetric(d.KERNING,K.css("letter-spacing")).addMetric(d.LINE_LEADING,(O==="normal"||O.length===0)?R:O).addMetric(d.LINE_LENGTH,E=b(s(K))).addMetric(d.MARGIN,I=K.css("margin-left")||0).addMetric(d.PADDING,M=K.css("padding-left")||0).addMetric(d.STYLIZED_TEXT,n(K)||K.css("font-style")==="italic"||K.css("font-variant")==="small-caps").addMetric(d.TEXT_COLOR,Q=A(K.css("color"))).addMetric(d.TEXT_COLOR_CONTRAST,b(x(P,Q))).addMetric(d.TEXT_LENGTH,S);
if(I==="auto"&&J){I=(K.outerWidth(true)-K.outerWidth())/2}H.addMetric(d.MARGIN_AND_PADDING,N=g(I)+g(M));H.addMetric(d.EFFECTIVE_MARGIN_AND_PADDING,(F&&P===F.getMetric(d.BACKGROUND_COLOR))?N+(F.getMetric(d.EFFECTIVE_MARGIN_AND_PADDING)||0):N);L.html("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&nbsp;");L.css({display:"inline",width:"auto"}).insertBefore(K);H.addMetric(d.CHARACTERS_PER_LINE,E/(L.width()/53));L.remove()}if(P){G=P}if(H.textTreeChildren){f.each(H.textTreeChildren,function(){j(this,G,H)
})}}function t(G,J){var F=d.FONT_SIZE,I=o(G.getMetric(F)),E=12-I,H=E<0?10:Math.max(10-E*2,0);J.addScore(F,b(H))}function y(F,G){var E=d.JUSTIFICATION;G.addScore(E,F.getMetric(E).match(/left|start|\-webkit\-auto/)?10:0)}function z(E,I){var G=E.getMetric(d.TEXT_COLOR_CONTRAST),F=E.getMetric(d.FONT_SIZE),H;H=Math.floor(G*(F>=o(18)||(F>=o(14)&&n(target))?0.45:0.7));I.addScore(d.TEXT_COLOR_CONTRAST,Math.min(10,H))}function q(G,I){var L=d.LINE_LEADING,K=G.getMetric(L),M=G.getMetric(d.FONT_SIZE),F=g(M),J=Math.ceil(F*1.5),E=J-g(K),H=Math.min(10*(1-(Math.abs(E)/F)),10);
I.addScore(L,b(H))}function h(E,F){F.addScore(d.PERCENTAGE_OF_TEXT_STYLIZED,E.getMetric(d.STYLIZED_TEXT)?0:10)}function l(G,J){if(!G.getMetric(d.BLOCK_ELEMENT)){return}var F=G.getMetric(d.CHARACTERS_PER_LINE),E=F-80,I=Math.abs(E),H=(E>0)?Math.max((10-Math.round(I/5)),0):Math.min(Math.max((10-Math.round((I-10)/10)),0),10);J.addScore(d.LINE_LENGTH,b(H))}function p(G,J){if(!G.getMetric(d.BLOCK_ELEMENT)){return}var F=G.getMetric(d.EFFECTIVE_MARGIN_AND_PADDING),H=G.getMetric(d.FONT_SIZE),E=g(H),I=Math.min(10,10*F/E);
J.addScore(d.MARGIN_AND_PADDING,I)}function D(F,E){var G=new a(F);if(!F.getMetric(d.BACKGROUND_COLOR)){F.updateMetric(d.BACKGROUND_COLOR,E.getMetric(d.BACKGROUND_COLOR))}if(F.textChildren&&F.textChildren.length){t(F,G);y(F,G);z(F,G);q(F,G);h(F,G);l(F,G);p(F,G)}else{G.addScore(d.FONT_SIZE,0).addScore(d.JUSTIFICATION,0).addScore(d.TEXT_COLOR_CONTRAST,0).addScore(d.LINE_LEADING,0).addScore(d.LINE_LENGTH,0).addScore(d.PERCENTAGE_OF_TEXT_STYLIZED,0).addScore(d.MARGIN_AND_PADDING,0)}if(F.textTreeChildren){f.each(F.textTreeChildren,function(){G.addChild(D(this,F))
})}return G}if(!(k.el&&k.el.length)){return"Provide a target to analyze."}if(f(k.el,k.options.context).size()==0){return"Target doesn't appear to be in the DOM."}var v=0,B=0,w,C,r=new a();k.el.each(function(){var G=f(this),J=new e(),I,F=0;w=u(G);if(!(C=A(G.css("background-color")))){var H=G;while(H&&H[0]!==document&&!(C=A(H.css("background-color")))){H=H.parent()}C=A(C)||"#ffffff"}I=G.parent();while(I[0].nodeType!=9&&I.css("display")==="block"){var E=I.css("margin-left")||0;F+=g(I.css("padding-left")||0);
if(E==="auto"){E=(I.outerWidth(true)-I.outerWidth())/2}F+=g(E);I=I.parent()}J.addMetric(d.BACKGROUND_COLOR,C);J.addMetric(d.EFFECTIVE_MARGIN_AND_PADDING,F);j(w,C,J);r.addChild(D(w))});r.rollUp();return r}})(jQuery);